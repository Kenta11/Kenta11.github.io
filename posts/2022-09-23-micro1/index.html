<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=theme-color content="#494f5c"><meta name=msapplication-TileColor content="#494f5c"><meta itemprop=name content="情報工学実験II（再履修）"><meta itemprop=description content="はじめに 出身学科も出身専攻も，完全に名称が無くなってしまいましたね． 過ごした時間に思いを馳せながら，マイクロプログラミングをしましょう（急展"><meta itemprop=datePublished content="2022-09-23T22:00:00+09:00"><meta itemprop=dateModified content="2022-09-23T22:00:00+09:00"><meta itemprop=wordCount content="1158"><meta itemprop=keywords content="MICRO-1,Rust,"><meta property="og:title" content="情報工学実験II（再履修）"><meta property="og:description" content="はじめに 出身学科も出身専攻も，完全に名称が無くなってしまいましたね． 過ごした時間に思いを馳せながら，マイクロプログラミングをしましょう（急展"><meta property="og:type" content="article"><meta property="og:url" content="https://Kenta11.github.io/posts/2022-09-23-micro1/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-09-23T22:00:00+09:00"><meta property="article:modified_time" content="2022-09-23T22:00:00+09:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="情報工学実験II（再履修）"><meta name=twitter:description content="はじめに 出身学科も出身専攻も，完全に名称が無くなってしまいましたね． 過ごした時間に思いを馳せながら，マイクロプログラミングをしましょう（急展"><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color><link rel="shortcut icon" href=/favicon.ico><title>情報工学実験II（再履修）</title><link rel=stylesheet href=https://Kenta11.github.io/css/style.min.037b6ee8f8c1baab6a3d0a9da11c3ff18a7552471f16c59fd98538d5ce99208b.css integrity="sha256-A3tu6PjBuqtqPQqdoRw/8Yp1UkcfFsWf2YU41c6ZIIs=" crossorigin=anonymous></head><body id=page><header id=site-header class="animated slideInUp"><div class="hdr-wrapper section-inner"><div class=hdr-left><div class=site-branding><a href=https://Kenta11.github.io>Kenta Arai Webpage</a></div><nav class="site-nav hide-in-mobile"><a href=https://Kenta11.github.io/posts/>Posts</a>
<a href=https://Kenta11.github.io/about/>About</a>
<a href=https://Kenta11.github.io/projects/>Projects</a></nav></div><div class="hdr-right hdr-icons"><button id=toc-btn class="hdr-btn desktop-only-ib" title="Table of Contents"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-list"><line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><line x1="3" y1="6" x2="3" y2="6"/><line x1="3" y1="12" x2="3" y2="12"/><line x1="3" y1="18" x2="3" y2="18"/></svg></button><span class="hdr-social hide-in-mobile"><a href=https://twitter.com/isKenta14 target=_blank rel="noopener me" title=Twitter><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a><a href=https://github.com/Kenta11 target=_blank rel="noopener me" title=Github><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a><a href=https://gitlab.com/Kenta111 target=_blank rel="noopener me" title=Gitlab><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22.65 14.39 12 22.13 1.35 14.39a.84.84.0 01-.3-.94l1.22-3.78 2.44-7.51A.42.42.0 014.82 2a.43.43.0 01.58.0.42.42.0 01.11.18l2.44 7.49h8.1l2.44-7.51A.42.42.0 0118.6 2a.43.43.0 01.58.0.42.42.0 01.11.18l2.44 7.51L23 13.45a.84.84.0 01-.35.94z"/></svg></a><a href=https://qiita.com/Kenta11 target=_blank rel="noopener me" title=Qiita><svg xmlns="http://www.w3.org/2000/svg" class="feather feather-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"/></svg></a><a href=https://speakerdeck.com/kenta11 target=_blank rel="noopener me" title=Speakerdeck><svg xmlns="http://www.w3.org/2000/svg" class="feather feather-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"/></svg></a></span><button id=menu-btn class=hdr-btn title=Menu><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button></div></div></header><div id=mobile-menu class="animated fast"><ul><li><a href=https://Kenta11.github.io/posts/>Posts</a></li><li><a href=https://Kenta11.github.io/about/>About</a></li><li><a href=https://Kenta11.github.io/projects/>Projects</a></li></ul></div><script async src="https://www.googletagmanager.com/gtag/js?id=G-VL3DZQ23CP"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-VL3DZQ23CP")</script><main class="site-main section-inner animated fadeIn faster"><article class=thin><header class=post-header><div class=post-meta><span>Sep 23, 2022</span></div><h1>情報工学実験II（再履修）</h1></header><div class=content><h2 id=はじめに>はじめに<a href=#はじめに class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h2><p>　出身学科も出身専攻も，完全に名称が無くなってしまいましたね．
過ごした時間に思いを馳せながら，マイクロプログラミングをしましょう（急展開）．</p><h2 id=アセンブラ>アセンブラ<a href=#アセンブラ class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h2><h3 id=一覧>一覧<a href=#一覧 class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h3><ul><li>機械語アセンブラ: <a href=https://github.com/Kenta11/rm1asm>rm1asm</a></li><li>マイクロアセンブラ: <a href=https://github.com/Kenta11/rm1masm>rm1masm</a></li></ul><h3 id=特徴>特徴<a href=#特徴 class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h3><ul><li>Unicode対応</li><li>マルチプラットフォームで動作（Windows，Linux，MacOS）</li><li>エラー表示機能付き（期待に添える程のクオリティ<strong>ではない</strong>）</li></ul><h2 id=遊び方>遊び方<a href=#遊び方 class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h2><p>　まずはアセンブラとシミュレータをインストールして下さい．
アセンブラは<code>cargo install</code>でもインストールできますが，特にLinuxをお使いの方は<a href=https://github.com/Kenta11/rm1asm/releases/tag/v1.0.0>パッケージ</a>からのインストールが便利です．
シミュレータはWindowsユーザなら公式（？）に配布されているものを使いましょう．
それ以外の方は自前でビルドして下さい．</p><pre tabindex=0><code>$ git clone https://github.com/Kenta11/micro1
$ cd micro1
$ gcc m1sim.c -o m1sim
</code></pre><p>　MICRO-1のマイクロプログラムをアセンブルします．</p><pre tabindex=0><code>$ curl -s http://www.ced.is.utsunomiya-u.ac.jp/lecture/2022/jikkenb/micro/chap5/MICROONE | iconv -f sjis -t utf8 | tr -d &#34;\32&#34; &gt; MICROONE
$ rm1masm MICROONE -o MICROONE.o
</code></pre><p>　続いて機械語プログラムをアセンブルします．</p><pre tabindex=0><code>$ cat sqrt
; This program is distributed under MIT LICENSE.
; Copyright (c) 2022 Kenta Arai
; 平方根を求めるプログラム
; アルゴリズムは&#34;バビロニア人の方法&#34;である

TITLE SQRT
         L   1, X0
         L   3, ERROR
; X(n+1)を計算
HEAD:    LEA 2, (1)
         LC  0, 0
         L   1, S
         BSR CALCXN1
; |X(n+1) - X(n)| &lt; ERROR の場合は計算を終了する
         SUB 2, (1)   ; X(n) - X(n+1)
         BSR ABS      ; |X(n+1) - X(n)|
         SUB 2, (3)   ; |X(n+1) - X(n)| - ERROR
         BNM HEAD
; 解を保存し，プログラムを終了
         ST  1, XN
         HLT

S:       DC  487      ; 入力
X0:      DC  20       ; 初期値X(0)
ERROR:   DC  5        ; エラー
XN:      DS  1        ; 解X(n)

; X(n+1)を計算する関数
; 入力: {r0: 0, r1: S, r2: X(n)}
; 出力: {r1: X(n+1), r2: X(n)}
CALCXN1: DIV 0, (2)   ; S/X(n)
         ADD 1, (2)   ; S/X(n) + X(n)
         SA  1, -1    ; (S/X(n) + X(n)) / 2 = X(n+1)
         RET

; 絶対値を計算する関数
; 入力: {r2: 整数}
; 出力: {r2: 絶対値}
ABS:     CMP 2, 0
         BNM ABS0
         XOR 2, X&#34;FFFF
         ADD 2, 1
ABS0:    RET 
END
$ rm1asm sqrt -o sqrt.b
</code></pre><p>　プログラムを実行してみましょう．</p><pre tabindex=0><code>$ ./m1sim

   *** MICRO-1 SIMULATOR (C-Ver. 1.0d) [Sep 23 2022] ***

&gt;&gt; load
LOAD
  FILE NAME=?MICROONE.o
  LOADING &#39;MICROONE.o&#39;
 LOADED TO CM
&gt;&gt; load       
LOAD
  FILE NAME=?sqrt.b
  LOADING &#39;sqrt.b&#39;
 LOADED TO MM
&gt;&gt; trace
TRACE
  T?device
   TD?set
   DEVICE ?pc
   DEVICE ?ir
   DEVICE ?flag
   DEVICE ?r0
   DEVICE ?r1
   DEVICE ?r2
   DEVICE ?r3
   DEVICE ?lbus
   DEVICE ?rbus
   DEVICE ?abus
   DEVICE ?sbus
   DEVICE ?.
   TD?.

  T?go
 CMAR=?101
 MAX STEP=?300
CMAR  PC   IR  ZNCOCT  R0   R1   R2   R3  LBUS RBUS ABUS SBUS 
102  0000 0000 000010 0000 0000 0000 0000 0000 0040 0040 0040 
～中略～
CMAR  PC   IR  ZNCOCT  R0   R1   R2   R3  LBUS RBUS ABUS SBUS 
0FD  000C EF00 000010 0007 0016 FFFD 0005 0000 0000 0000 0000 
 CPU HALTED !
  259 STEPS USED
  T?.
&gt;&gt; dump
DUMP
  D?mm
    START ADRS ?000C
    END   ADRS ?000F
000C:01E7
000D:0014
000E:0005
000F:0016
  D?.
&gt;&gt; end
&gt;&gt;   MICRO-1 TERMINATED
</code></pre><p>　XN(アドレスが0x000Fの行)に487の大体の平方根22(0x0016)が格納されていますね．
大大大成功です．</p><h2 id=おわりに>おわりに<a href=#おわりに class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h2><p>　Rust製の言語処理系ライブラリ（logosとchumsky）で遊んでいたら，いつの間にかアセンブラを書いていた．
何を言っているのか わからねーと思うが（以下略）</p><p>　MICRO-1が書かれた書籍は絶版だし，このまま授業も無くなってしまったら悲しいですね．
アセンブラはGitHubに置いておけばしばらくは残ると思うので，歴史的なアレコレとして誰か活用して下さい．</p><p>　P.S. サンプルプログラムのライセンスが不明なので，本家からダウンロードできなくなったらどうしよう&mldr;</p><p>おしまい</p></div><hr class=post-end><footer class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=tag><a href=https://Kenta11.github.io/tags/micro-1>MICRO-1</a></span><span class=tag><a href=https://Kenta11.github.io/tags/rust>Rust</a></span></p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>1158 Words</p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>2022-09-23 13:00 +0000</p></footer></article><aside id=toc><div class=toc-title>Table of Contents</div><nav id=TableOfContents><ul><li><a href=#はじめに>はじめに</a></li><li><a href=#アセンブラ>アセンブラ</a><ul><li><a href=#一覧>一覧</a></li><li><a href=#特徴>特徴</a></li></ul></li><li><a href=#遊び方>遊び方</a></li><li><a href=#おわりに>おわりに</a></li></ul></nav></aside><div class="post-nav thin"><a class=next-post href=https://Kenta11.github.io/posts/2022-12-19-classic-engei/><span class=post-nav-label><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>&nbsp;Newer</span><br><span>これまでに観た古典芸能の演目</span></a>
<a class=prev-post href=https://Kenta11.github.io/posts/2022-08-19-set-static-ip-jp/><span class=post-nav-label>Older&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg></span><br><span>Manjaroで静的IPアドレスを設定</span></a></div><div id=comments class=thin></div></main><footer id=site-footer class="section-inner thin animated fadeIn faster"><p>&copy; 2023 <a href=https://Kenta11.github.io>Kenta Arai</a></p><p>Made with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> &#183; Theme <a href=https://github.com/Track3/hermit target=_blank rel=noopener>Hermit</a> &#183; <a href=https://Kenta11.github.io/posts/index.xml target=_blank title=rss><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></p></footer><script src=https://Kenta11.github.io/js/bundle.min.580988ed2982bcbb74a1773c7abea97b43e4c43b9324e10cda0813ec6ec4bb67.js integrity="sha256-WAmI7SmCvLt0oXc8er6pe0PkxDuTJOEM2ggT7G7Eu2c=" crossorigin=anonymous></script></body></html>